var x, y, tag, code, deviceID, _E5_88_86_E5_B8_83_E4_BA_BA_E6_95_B8, _E5_9F_B7_E8_A1_8C_E7_8B_80_E6_85_8B, command;

  function mqttBinarytobase64(input_array) {
    const content = new Uint8Array(input_array);
    return btoa(String.fromCharCode.apply(null, content));
  }


// 描述此函式...
function _E5_88_86_E5_B8_83_E7_8B_80_E6_85_8B(x, y) {
  if (x >= 0 && y >= 0) {
    _E5_88_86_E5_B8_83_E4_BA_BA_E6_95_B8[0] = _E5_88_86_E5_B8_83_E4_BA_BA_E6_95_B8[0] + 1;
  } else if (x <= 0 && y >= 0) {
    _E5_88_86_E5_B8_83_E4_BA_BA_E6_95_B8[1] = _E5_88_86_E5_B8_83_E4_BA_BA_E6_95_B8[1] + 1;
  } else if (x >= 0 && y <= 0) {
    _E5_88_86_E5_B8_83_E4_BA_BA_E6_95_B8[2] = _E5_88_86_E5_B8_83_E4_BA_BA_E6_95_B8[2] + 1;
  } else if (x <= 0 && y <= 0) {
    _E5_88_86_E5_B8_83_E4_BA_BA_E6_95_B8[3] = _E5_88_86_E5_B8_83_E4_BA_BA_E6_95_B8[3] + 1;
  }
}

// 描述此函式...
function _E9_96_8B_E9_97_9C_E9_9B_BB_E6_89_87() {
  _E9_A2_A8_E6_89_87('RF', 1);
  _E9_A2_A8_E6_89_87('LF', 2);
  _E9_A2_A8_E6_89_87('RB', 3);
  _E9_A2_A8_E6_89_87('LB', 4);
}

// 描述此函式...
function _E9_A2_A8_E6_89_87(tag, code) {
  if (_E5_88_86_E5_B8_83_E4_BA_BA_E6_95_B8[(code - 1)] == 1) {
    mqtt_client.publish('smartfan/ir', String(('?'+tag+'='+'m1'+';'+'s1')));
    span_set(tag,"innerHTML",('?'+tag+'='+'m1'+';'+'s1'));
  } else if (_E5_88_86_E5_B8_83_E4_BA_BA_E6_95_B8[(code - 1)] > 1) {
    mqtt_client.publish('smartfan/ir', String(('?'+tag+'='+'m1'+';'+'s0')));
    span_set(tag,"innerHTML",('?'+tag+'='+'m1'+';'+'s0'));
  } else {
    mqtt_client.publish('smartfan/ir', String(('?'+tag+'='+'m0'+';'+'s1')));
    span_set(tag,"innerHTML",('?'+tag+'='+'m0'+';'+'s1'));
  }
}


head_add_viewport(1,1,2,"yes");
const clientId = "mqtt_" + Math.random().toString(16).substr(2, 8);
const options = {
username: '',
password: '',
keepalive: 60,
clientId: clientId,
protocolId: "MQTT",
protocolVersion: 4,
clean: true,
reconnectPeriod: 1000,
connectTimeout: 30 * 1000
}

var mqtt_client = mqtt.connect('wss://broker.emqx.io:8084/mqtt',options);
mqtt_client.on("connect", ()=>{
console.log("connected");
  mqtt_client.subscribe('smartfan/temperature');
  mqtt_client.subscribe('smartfan/humidity');
mqtt_client.on("message", async function (topic, payload) {
  var deviceID = (new TextDecoder().decode(payload)).split(',')[0];
  simpleSwitch({id: deviceID,val: 1});
   })
  }
)

_E5_88_86_E5_B8_83_E4_BA_BA_E6_95_B8 = [0, 0, 0, 0];
simpleSwitch({
id: 'RF',
width: 80,
height: 40,
left: 100,
top: 150,
text: '右前(RF)',
size: 14,
color: '#33cc00',
val: 0,
func: switch_XTgasjDNVNy
});
simpleSwitch({
id: 'LF',
width: 80,
height: 40,
left: 40,
top: 150,
text: '左前(LF)',
size: 14,
color: '#33cc00',
val: 0,
func: switch_cTJJEOfripDikacVR
});
simpleSwitch({
id: 'RB',
width: 80,
height: 40,
left: 100,
top: 200,
text: '右後(RB)',
size: 14,
color: '#33cc00',
val: 0,
func: switch_xzXVUHVL
});
simpleSwitch({
id: 'LB',
width: 80,
height: 40,
left: 40,
top: 200,
text: '左後(LB)',
size: 14,
color: '#33cc00',
val: 0,
func: switch_TWlWRmVXNwEDG
});
span_create('LB',40,100,14,'',999);
span_create('LF',40,140,14,'',999);
span_create('RB',200,100,14,'',999);
span_create('RF',200,140,14,'',999);
mqtt_client.publish('smartfan/ir', String(('?'+'ALL'+'='+'TH')));
_E5_9F_B7_E8_A1_8C_E7_8B_80_E6_85_8B = true;
cocossd_video("none","1","1","1");
cocossd_startvideo_media(320,240,"front",0);
span_set('LB',"color",(HextoRgb('#ffff00')));
span_set('LF',"color",(HextoRgb('#ffff00')));
span_set('RB',"color",(HextoRgb('#ffff00')));
span_set('RF',"color",(HextoRgb('#ffff00')));

cocossd_recognitionFinish = async function() {
cocossd_state(0);
  canvas_line(("cocossd"),1,160,0,160,240,'#ffff33',0,1);
  canvas_line(("cocossd"),1,0,120,320,120,'#ffff33',0,1);
  canvas_text(("cocossd"),'RF',280,230,'Arial',30,"start",true,'#33ff33',0,1);
  canvas_text(("cocossd"),'LF',0,230,'Arial',30,"start",true,'#33ff33',0,1);
  canvas_text(("cocossd"),'RB',280,25,'Arial',30,"start",true,'#33ff33',0,1);
  canvas_text(("cocossd"),'LB',0,25,'Arial',30,"start",true,'#33ff33',0,1);
  if (_E5_9F_B7_E8_A1_8C_E7_8B_80_E6_85_8B == true) {
    _E5_9F_B7_E8_A1_8C_E7_8B_80_E6_85_8B = false;
    _E5_88_86_E5_B8_83_E4_BA_BA_E6_95_B8 = [0, 0, 0, 0];
    if ((cocossd_object_number("person")) > 0) {
      var command_end = (cocossd_object_number("person")) - 1;
      var command_inc = 1;
      if (0 > command_end) {
        command_inc = -command_inc;
      }
      for (command = 0; command_inc >= 0 ? command <= command_end : command >= command_end; command += command_inc) {
        canvas_arc(("cocossd"),3,(cocossd_object("person",command,"bottomx")),(cocossd_object("person",command,"bottomy")),3,0,6.284,false,true,'#ffff00',0,1);
        _E5_88_86_E5_B8_83_E7_8B_80_E6_85_8B((cocossd_object("person",command,"bottomx")) - 160, (cocossd_object("person",command,"bottomy")) - 120);
      }
    }
    _E9_96_8B_E9_97_9C_E9_9B_BB_E6_89_87();
    setTimeout(async function(){
      _E5_9F_B7_E8_A1_8C_E7_8B_80_E6_85_8B = true;
    },10000);
  }

cocossd_state(1);};

function switch_XTgasjDNVNy() {

}

function switch_cTJJEOfripDikacVR() {

}

function switch_xzXVUHVL() {

}

function switch_TWlWRmVXNwEDG() {

}
